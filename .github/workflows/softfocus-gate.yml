name: SoftFocus Gates

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      # -------------------------
      # Checkout & Environment
      # -------------------------
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies
        run: npm ci

      # -------------------------
      # Content & Build Checks
      # -------------------------
      - name: Content lint
        run: npm run content:lint

      - name: Build project
        run: npm run build

      # -------------------------
      # Governance Stages
      # -------------------------
      - name: Stage 0 â€” Repository integrity
        run: ./scripts/stages/stage-0-repo.sh

      - name: Stage 1 â€” Assessment model
        run: ./scripts/stages/stage-1-assessment.sh

      - name: Stage A â€” Protocol compliance
        run: ./scripts/stages/stage-a-protocol.sh

      - name: Stage B â€” Localization
        run: ./scripts/stages/stage-b-localization.sh

      - name: Stage C â€” Conversion & surfaces
        run: ./scripts/stages/stage-c-conversion.sh

      # -------------------------
      # ðŸ”’ Maintenance Mode Guard
      # -------------------------
      - name: Maintenance Mode Guard
        run: |
          if grep -q "Phase D is COMPLETE" docs/phase-d/PHASE_D_ARCHIVE.md; then
            echo "Maintenance Mode active â€” enforcing restrictions"
            bash scripts/governance/maintenance-mode/check-maintenance-mode.sh
          else
            echo "Maintenance Mode not active â€” skipping guard"
          fi
